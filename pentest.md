# Pentest

## Ressources

https://book.hacktricks.xyz/

Shell upgrade : https://d00mfist1.gitbooks.io/ctf/content/spawning_shells.html

Linpeas.sh : https://github.com/carlospolop/PEASS-ng

GTFObins : https://gtfobins.github.io/

https://github.com/swisskyrepo/PayloadsAllTheThings

https://github.com/0xsobky/HackVault/wiki/Unleashing-an-Ultimate-XSS-Polyglot

https://github.com/danielmiessler/SecLists

https://pentestmonkey.net/category/cheat-sheet

## tools

https://www.revshells.com/

https://github.com/AlessandroZ/LaZagne

## Metasploit

Pour démarrer :
```bash
msfdb init
msfdb status
msfconsole # -a demande confirmation avant de quitter, -q pas de bannière
    db_status
```

Sauvegarder session : `spool ~/msf_spool.log`

Aide :
```bash
help ou ?
info
search type/port/cve/platform
show exploits/auxiliary/targets/payloads/encoders
```

Pour rentrer/sortir d'un module :
```bash
info <exploit>
# OU
use <exploit>
info
back
```

Options de module :
```bash
options
advanced
show missing
save # enregistre les variables dans ~/.msf4/config
```

Variables (insensible à la casse) :
```bash
set <variable> <valeur>
setg <variable> <valeur>
get <variable>
getg <variable>
```

Interactions avec la db :
```bash
db_import   # importer des résultats de scans par des outils externes
db_nmap     # lance nmap et insert les résultats dans la db

creds/hosts/loot/notes/services/vulns/workspace
hosts -R permet de set RHOSTS directement
```

4 catégories de modules (show pour les lister) :
1. auxiliary
2. exploit
3. payload
4. post

Après avoir set les options, `run` pour lancer le module (-j pour lancer sous forme de job). Certains modules permettent `check` qui va juste tester l'exploitabilité.

## Web

Détecter les proxy : Méthode `TRACE` (de moins en moins disponible sur les srv web)
Détecter les IPS/WAF : utiliser des mots caractéristiques d'une attaque et voir si page d'erreur (peut permettre d'identifier l'équipement)
Détecter les applications :
- utiliser un dictionnaire sur l'en-tête `Host` de la requête pour trouver des vhosts
- recherche DNS inverse : `dig +short -x <IP>`
- recherche bing/yahoo avec `ip:<IP>`

## SSH

**L**ocal Port Forwarding : ssh host -L 9000:remote_addr:80 puis curl localhost:9000
**R**emote Port Forwarding :
**D**ynamic Port Forwarding : ssh host -D 9000 puis paramétrer un sock proxy dans firefox sur localhost:9000

### Proxychains

Sur la machine locale, editer `/etc/proxychains.conf` :
```
[ProxyList]
socks5 127.0.0.1 9999
...
```

Puis créer le point de sortie avec `ssh root@web -D 9999`.

Plus d'infos sur https://man.cx/proxychains.

## Privilege escalation

Trouver les binaires suid :
```
find / -user root -perm -4000 -exec ls -t {} \; 2>/dev/null
```

systemctl : https://gtfobins.github.io/gtfobins/systemctl/

## Infrastructure

Serveur web :
```bash
python3 -m http.server 8080
```

## Reverse shell

Pour se mettre en écoute :
```bash
# rlwrap permet d'avoir le confort de UP LEFT TAB
rlwrap nc -lnvp 9007
```

[Upgrade de shell](https://d00mfist1.gitbooks.io/ctf/content/spawning_shells.html)
